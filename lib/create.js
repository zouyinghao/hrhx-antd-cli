// æ‰“å°æ¬¢è¿ç•Œé¢ï¼ˆç”Ÿæˆç•Œé¢çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„å›è°ƒè¿‡ç¨‹ï¼Œä½¿ç”¨promisifyå°è£…ï¼‰
const { promisify } = require('util')
const figlet = promisify(require('figlet'))

// ç”Ÿæˆæ¬¢è¿ç•Œé¢ä¹‹å‰ï¼Œå…ˆæ¸…ç©ºå‘½ä»¤è¡Œ
const clear = require('clear')

// æ‰“å°å½©è‰²çš„ log å‡½æ•°
const chalk = require('chalk')
const log = content => console.log(chalk.green(content))

// å…‹éš†
const { clone } = require('./download')

// æ‰“å¼€æµè§ˆå™¨
const open = require('open')

// ç¨‹åº installè‡ªåŠ¨å®‰è£…ä¾èµ–
const spawn = async (...args) => {
    const { spawn } = require('child_process')
    return new Promise(resolve => {
        // å­è¿›ç¨‹
        const proc = spawn(...args)
        // æ­£å¸¸æµ
        proc.stdout.pipe(process.stdout)
        // é”™è¯¯æµ
        proc.stderr.pipe(process.stderr)
        proc.on('close', () => {
            resolve()
        })
    })
}

module.exports = async name => {
    // æ‰“å°æ¬¢è¿ç•Œé¢
    const ora = require('ora')

    // æ¸…å±
    clear()
    const data = await figlet('Welcome   HRHX')
    log(data)

    // clone é¡¹ç›®
    // log(`ğŸš€ æ­£åœ¨ä¸ºæ‚¨åˆ›å»º [${name}] é¡¹ç›® ......`)
    // è¿›åº¦æ¡
    const loading1 = ora(`æ­£åœ¨ä¸ºæ‚¨åˆ›å»º ${name} é¡¹ç›®ï¼Œè¯·ç¨ç­‰ ......`)
    loading1.start()
    await clone('github:zouyinghao/hrhx-antd-template', name)
    loading1.succeed()

    // è‡ªåŠ¨å®‰è£…ä¾èµ–
    // log(`æ­£åœ¨ä¸ºæ‚¨å®‰è£… [${name}] é¡¹ç›®ä¾èµ–ï¼Œè¯·ç¨ç­‰ ......`)
    const loading2 = ora(`æ­£åœ¨ä¸ºæ‚¨å®‰è£… [${name}] é¡¹ç›®ä¾èµ–ï¼Œè¯·ç¨ç­‰ ......`)
    loading2.start()
    await spawn('yarn', ['install'], {cwd: `./${name}`, shell: process.platform === 'win32'})
    loading2.succeed()

    const sign = await figlet('HRHX   ANTD')
    log(sign)

//     log(chalk.green(`
//                                     ğŸ”¨ å®‰è£…å®Œæˆï¼š
//                                     To get Start:
// ====================================================================================
// â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
// â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•   â–ˆâ–ˆâ•”â•â•â•â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘ â•šâ•â•â–ˆâ–ˆâ•”â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘  â•šâ•â–ˆâ–ˆâ•”â•â•    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
// â–ˆâ–ˆâ•”â•â•â•â•â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•”â•â•â•â•â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
// â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â• â•šâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
// â•šâ•â•    â•šâ•â• â•šâ•â•   â•šâ•â• â•šâ•â•    â•šâ•â• â•šâ•â•   â•šâ•â•   â•šâ•â•    â•šâ•â• â•šâ•â•  â•šâ•â•â•â•    â•šâ•â•    â•šâ•â•â•â•â•â•
//
//                 Hrhx Ant Design Pro ------ Authorï¼šzouyh@sspss.com.cn
//                             Create Date: 2020-07-05
//
//                                   cd ${name}
//                                   yarn serve
// ====================================================================================
//     `))

    log('æ­£åœ¨ä¸ºæ‚¨å¯åŠ¨é¡¹ç›®ï¼Œå¯åŠ¨æˆåŠŸåä¼šè‡ªåŠ¨ä¸ºæ‚¨æ‰“å¼€æµè§ˆå™¨ï¼Œæ‚¨æ— éœ€æ‰‹åŠ¨æ“ä½œï¼')
    await spawn('yarn', ['serve'], {cwd: `./${name}`, shell: process.platform === 'win32'})
}
